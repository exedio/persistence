<html>
	<head>
		<link rel="stylesheet" href="cope.css">
	</head>
	<body>
		<a href="http://www.exedio.com">
			<img src="exedio.png" width="200" height="66" border="0" align="right">
		</a>
		<h1>COPE</h1>
		<div>Cope with Object Persistence</div>
		
		<h2>Your first item</h2>
		<a href="http://sourceforge.net/">
			<img src="http://sourceforge.net/sflogo.php?group_id=152867&amp;type=1"
				width="88" height="31" border="0" align="right" alt="SourceForge.net Logo" />
		</a>
		<div>
			Creating a new persistent class within COPE is
			as easy as creating any java class.
			Make sure, the class extends <tt>Item</tt>
		</div>
<pre>
import com.exedio.cope.Item;

class Customer extends Item
{
}
</pre>
		<div>
			Now a persistent class is'nt very useful
			without any persistent attributes,
			so we also create our first one.
			To do this we declare a static final constant
			of the type <tt>StringAttribute</tt>.
		</div>
<pre>
import com.exedio.cope.Item;
import com.exedio.cope.StringAttribute;

class Customer extends Item
{
   static final StringAttribute email = new StringAttribute(DEFAULT);
}
</pre>
		<div>
			Thats the way you declare persistent classes and fields.
			Now we have to setup the cope source code instrumentor.
		</div>
		<h2>setting up the instrumentor</h2>
		<div>
			The instrumentor inserts a few methods and constructors into your
			source code, so you don't have to write it on your own.
			Don't worry, your code and the code generated by the instrumentor
			will peacefully coexist.
		</div>
		<div>
			Get a copy of <tt>exedio-cope.jar</tt> and <tt>exedio-cope-instrument.jar</tt>
			and put it into the directory where you keep your third-party libraries.
			In the following we assume, this is <tt>lib</tt>.
		</div>
		<div>
			Next we have to include the code instrumentor into your build process.
			Here we explain this for a build process managed by
			<a href="http://ant.apache.org/">apache ant</a>.
			We assume, that there is already a target <tt>compile</tt> which compiles
			your projects sources including class <tt>Customer</tt> created above
			located in directory <tt>src</tt>.
			Put the following into your <tt>build.xml</tt>
<pre>
&lt;taskdef name="instrument" classname="com.exedio.cope.instrument.AntTask"&gt;
  &lt;classpath&gt;
    &lt;pathelement location="<i>lib/exedio-cope-instrument.jar</i>" /&gt;
  &lt;/classpath&gt;
&lt;/taskdef&gt;

&lt;target name="instrument"&gt;
  &lt;instrument verbose="false"&gt;
    &lt;fileset dir="<i>${basedir}/src</i>"&gt;
      &lt;include name="*.java" /&gt;
    &lt;/fileset&gt;
  &lt;/instrument&gt;
&lt;/target&gt;
</pre>
		<div>
			Parts in <tt><i>italics</i></tt> need to be adapted to your
			directory layout.
			Make target <tt>compile</tt> depend on target <tt>instrument</tt> and
			add <tt>lib/exedio-cope.jar</tt> to the classpath of the <tt>javac</tt> task.
		</div>
		<div>
			Now the instrumentor is ready to run.
			On the command line type <tt>ant instrument</tt>.
		</div>
		<h2>results of the instrumentor</h2>
		<div>
			After running the instrumentor,
			the class <tt>Customer</tt> contains a few more methods and constructors.
			Lets have a look, what these are useful for.
		</div>
		<div>
			The first one in the <i>default creation constructor</i>:
		</div>
<pre>
   Customer(String email)
   {
      this(new SetValue[]{Customer.email.map(email)});
   }
</pre>
		<div>
			It creates a new customer and sets the initial value of the attribute
			<tt>email</tt> for that customer.
			Note, for brevity the code snippet above does not include
			javadoc comments generated by the instrumenter.
		</div>
		<div>
			Next one is the generic creation constructor:
		</div>
<pre>
   Customer(SetValue[] setValues)
   {
      super(setValue);
   }
</pre>
		<div>
			It creates a new customer and sets the initial values for any set of attributes
			for that customer.
			This comes handy if there are more attributes in class Customer,
			since by default not all attributes are set by the <i>default creation constructor</i>.
		</div>
		<div>
			Next one is the <i>reactivation constructor</i>:
		</div>
<pre>
   Customer(ReactivationConstructorDummy d, int pk)
   {
      super(d, pk);
   }
</pre>
		<div>
			All you need to know about this for now is,
			that COPE uses this constructor internally and you don't have to care about.
			This constructor is one of the few things cope has to demand for all persistent classes.
		</div>
		<div>
			Next are the <i>attribute getter</i>
			and <i>attribute setter</i> for the attribute <tt>email</tt>:
		</div>
<pre>
   String getEmail()
   {
      return email.get(this);
   }

   void setEmail(String email)
   {
      Customer.email.set(this, email);
   }
</pre>
		<div>
			These allow convenient read/write access to the values of the attribute,
			after the creation of the item.
		</div>
		<div>
			Last but not least there is the <i>type constant</i>:
		</div>
<pre>
   static final Type TYPE = Type.newType(Customer.class);
</pre>
		<div>
			This is useful for all sorts of things,
			most prominently searching the database.
			We'll get there in detail later.
			For now just two examples:
			<ol>
				<li>
					Searching for all customers is as easy as
					<tt>Customer.TYPE.search(null)</tt>.
					The result of this is even a typed list <tt>List&lt;Customer&gt;</tt>
				</li>
				<li>
					Searching for customers with a certain email address is done by
					<tt>Customer.TYPE.search(Customer.email.equal("cope@exedio.com"))</tt>.
				</li>
			</ol>
		</div>
		<div>
			Next we will really store some persistent data.
		</div>
		<h2>Make it run</h2>
		<div>
			Also get a jdbc driver in your classpath.
			In this manual we will start with
			<a href="http://www.hsqldb.org">hsqldb</a>, version 1.8.0.
			
			
			
<pre>
database=hsqldb
database.url=jdbc:hsqldb:mem:copetest
database.user=sa
database.password=
</pre>
		</div>
		<div>
		</div>
	</body>
</html>
