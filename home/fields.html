<html>
	<head>
		<title>COPE - Field Trail</title>
		<meta name="keywords" content="Persistence, Java">
		<meta name="description" content="COPE - a persistence framework for Java">
		<link rel="stylesheet" href="cope.css">
	</head>
	<body>
		<a href="http://www.exedio.com/">
			<img src="exedio.png" class="exedio">
		</a>
		<h1><a href="index.html">COPE</a></h1>
		<div>Cope with Object Persistence</div>
		
		<h2>Field Trail</h2>
		<a href="http://sourceforge.net/">
			<img src="http://sourceforge.net/sflogo.php?group_id=152867&amp;type=1"
				class="sf" alt="SourceForge.net Logo" />
		</a>
		<div>
			While the <a href="intro.html">Introduction Trail</a>
			covered string fields only,
			this trails visits all kinds of other fields
			as well as the more special features of string fields.
		</div>
		<h3><a name="contents">Contents</a></h3>
		<ul>
			<li><a href="#common">Common Primitives</a></li>
			<li><a href="#null">Allowing Null</a></li>
			<li><a href="#defaults">Default Values</a></li>
			<li><a href="#unique">Unique Fields</a></li>
			<li><a href="#enum">Enum Fields</a></li>
			<li><a href="#item">Item Fields</a></li>
			<li><a href="#further">Further Reading</a></li>
		</ul>
		<h3><a name="common">Common Primitives</a></h3>
		<div>
			COPE provides fields for all commonly used java primitives
			as well as for <tt>String</tt> and <tt>java.util.Date</tt>.
			This looks like this.
		</div>
<pre>
class Customer extends Item
{
   static final StringField email =
       new StringField();
   static final DateField registrationDate =
       new DateField();
   static final LongField loginCounter =
       new LongField();
   static final IntegerField subsequentLoginFailures =
       new IntegerField();
   static final DoubleField priceCoefficient =
       new DoubleField();
}
</pre>
		<div>
			Run the instrumentor, and you get setters/getters for all
			the new fields.
			Also the <i>default creation constructor</i>
			will have parameters for the initial values of these fields.
		</div>
		<h3><a name="null">Allowing Null</a></h3>
		<div>
			You may have noticed, that you cannot store null
			into any of the fields.
			This is because fields are <i>mandatory</i> by default.
			You can easily change this to <i>optional</i>.
		</div>
<pre>
static final LongField loginCounter =
    new LongField(<b>OPTIONAL</b>);
</pre>
		<div>
			When you run the instrumentor, you may notice
			a few changes in the generated code.
			<ol>
				<li>
					The <i>default creation constructor</i> does not
					include a parameter for <tt>loginCounter</tt> anymore.
					This is because a value for <tt>loginCounter</tt> is not needed
					for constructing an instance of Customer anymore.
					If you still want to have <tt>loginCounter</tt> included into
					the <i>default creation constructor</i> add a
					<tt>@cope.initial</tt> tag to the field:
<pre>
/**
 * <b>@cope.initial</b>
 */
static final LongField loginCounter =
    new LongField(OPTIONAL);
</pre>
				</li>
				<li>
					The signature of the getter and setter for <tt>loginCounter</tt>
					changed.
					Before, it used the primitive type <tt>long</tt>
<pre>
<b>long</b> getLoginCounter() { ... }
void setLoginCounter(<b>long</b> loginCounter) { ... }
</pre>
					but now being optional it uses the wrapper class <tt>java.lang.Long</tt>.
<pre>
<b>Long</b> getLoginCounter() { ... }
void setLoginCounter(<b>Long</b> loginCounter) { ... }
</pre>
				</li>
			</ol>
				</li>
		</div>
		<h3><a name="defaults">Default Values</a></h3>
		<div>
			What we did above with the login counter is probably not,
			what one would want in a real project.
			One would probably rather want to make it <i>mandatory</i>
			and initialize it to zero for any newly created customer.
			This can be specified by:
		</div>
<pre>
static final LongField loginCounter =
    new LongField()<b>.defaultTo(0l)</b>;
</pre>
		<div>
			In the instrumented code the type for setter/getter
			changes back to primitives again,
			but the <i>default creation constructor</i> does also
			not have a parameter for <tt>loginCounter</tt>.
		</div>
		<div>
			If you want to make the current date the default value
			of any date field,
			then of course <tt>defaultTo(new Date())</tt> won't work.
			Use instead:
		</div>
<pre>
static final DateField registrationDate =
    new DateField()<b>.defaultToNow()</b>;
</pre>
		<h3><a name="unique">Unique Fields</a></h3>
		<div>
			Probably you wouldn't want to have more than one customer
			for any given email address.
			Peace of cake:
		</div>
<pre>
static final StringField email =
    new StringField(<b>UNIQUE</b>);
</pre>
		<div>
			If you violate this unique constraint either via a
			creation constructor or via <tt>setEmail</tt>
			this will throw a <tt>UniqueViolationException</tt>.
		</div>
		<div>
			In the instrumented code you will find a new convenience method
		</div>
<pre>
static final Customer findByEmail(String email);
</pre>
		<div>
			which does, what it's name suggests.
		</div>
		<div>
			For unique constraints across multiple fields
			the notation is slightly different:
		</div>
<pre>
class MatrixElement extends Item
{
   static final IntegerField x =
       new IntegerField();
   static final IntegerField y =
       new IntegerField();
   static final UniqueConstraint xy =
       new UniqueConstraint(x, y);
}
</pre>
		<h3><a name="enum">Enum Fields</a></h3>
		<div>
			A common pattern in persistent models are fields,
			the can have a value out of a predefined set of values.
			For that purpose java provides enums since JDK 1.5.
			COPE allows you to store such enums in fields
			just like any other primitive:
		</div>
<pre>
class Customer extends Item
{
   static enum Status
   {
      STANDARD,
      GOLD,
      PLATINUM,
   }

   static final EnumField&lt;Status&gt; status =
       newEnumField(Status.class);
}
</pre>
		<h3><a name="item">Item Fields</a></h3>
		<div>
			An item fields stores a reference to another persistent item.
			It's the object oriented counter part of
			a foreign key constraint in relational databases.
		</div>
		<div>
			Here an example of a product referencing the product group it belongs to:
		</div>
<pre>
class ProductGroup extends Item
{
   static final StringField name =
       new StringField();
}
</pre>
<pre>
class Product extends Item
{
   static final ItemField&lt;ProductGroup&gt; productGroup =
       newItemField(ProductGroup.class);
}
</pre>
		<div>
			As specified above, a product group cannot be deleted,
			if there are still products referencing this product group.
			This is because the default <i>delete policy</i>
			of an item field is <i>forbid</i>.
			Alternativly you may want to have all products of a product group to be deleted,
			if that product group is deleted.
			To achive this, change the <i>delete policy</i> to <i>cascade</i>.
		</div>
<pre>
static final ItemField&lt;ProductGroup&gt; productGroup =
    newItemField(ProductGroup.class, <b>CASCADE</b>);
</pre>
		<div>
			Yet another alternative is to set the item field to null
			on all products referencing the product group to be deleted.
			This is done by:
		</div>
<pre>
static final ItemField&lt;ProductGroup&gt; productGroup =
    newItemField(<b>OPTIONAL</b>, ProductGroup.class, <b>NULLIFY</b>);
</pre>
		<div>
			Of course <i>nullify</i> makes no sense for a <i>mandatory</i> field,
			so I changed it to <i>optional</i>.
		</div>
		<h3><a name="further">Further Reading</a></h3>
		<div>
			This was the field trail of the cope tour.
			You may now proceed to trails:
			<ul>
				<li>
					<a href="transactions.html">Transactions Trail</a>
					tells you how to use transactions in cope.
				</li>
				<li>
					<a href="searching.html">Searching Trail</a>
					gives you an introduction into the searching capabilities of cope.
				</li>
				<li>
					<a href="fields2.html">Field Reloaded Trail</a>
					covers all the more specific possibilities to store data with cope.
				</li>
				<li>
					<a href="webapplications.html">Web Application Trail</a>
					shows you the little differences when using cope within a web container.
				</li>
			</ul>
		</div>
		<address>
			Copyright &copy; 2004-2006
			<a href="http://www.exedio.com/" target="_top">exedio</a>
			Gesellschaft f&uuml;r Softwareentwicklung mbH.
		</address>
	</body>
</html>
